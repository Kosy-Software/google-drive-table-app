(()=>{"use strict";(()=>{function e(e,t){let i=document.querySelector("#viewing").content.firstElementChild.cloneNode(!0),o=i.querySelector("iframe");return o.src=e.googleDriveUrl,o.style.height=`${window.innerHeight}px`,i}const t=new RegExp("^(https://drive.google.com|https://docs.google.com)");function i(e){return e&&t.test(e)}var o;function n(e,t){let o=document.querySelector("#picking").content.cloneNode(!0),n=o.querySelector("input"),l=o.querySelector("#open-file");return n.oninput=e=>{i(n.value)?(l.removeAttribute("disabled"),n.style.color="black"):(l.setAttribute("disabled","disabled"),n.style.color="red")},l.onclick=e=>{let i=n.value;t({type:"google-drive-url-changed",payload:i})},o.querySelector("#open-picker").onclick=e=>{return i=this,o=void 0,l=function*(){t({type:"file-picker-opened",payload:{}})},new((n=void 0)||(n=Promise))((function(e,t){function r(e){try{s(l.next(e))}catch(e){t(e)}}function a(e){try{s(l.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(r,a)}s((l=l.apply(i,o||[])).next())}));var i,o,n,l},o}function l(e,t){let i=document.querySelector("#waiting").content.firstElementChild.cloneNode(!0);return i.querySelector("label").innerHTML=`${e.initializer.clientName} is picking a file to share`,i}!function(t){var o;(function(t){class o{constructor(){this.kosyClient=window.parent,this.state={googleDriveUrl:null}}start(e){window.addEventListener("message",(e=>{this.receiveMessage(e.data)})),this.sendMessage({type:"ready-and-listening",payload:{}})}receiveMessage(e){var t;switch(e.type){case"receive-initial-info":let i=e.payload;this.initializer=i.clients[e.payload.initializerClientUuid],this.currentClient=i.clients[e.payload.currentClientUuid],this.state=null!==(t=i.currentIntegrationState)&&void 0!==t?t:this.state,this.log("Received initialization info: ",e.payload),this.renderComponent();break;case"receive-message":this.log("Received integration message: ",e.payload),this.processIntegrationMessage(e.payload);break;case"client-has-joined":this.log("A client has joined: ",e.payload);break;case"client-has-left":this.log("A client has left: ",e.payload),e.payload.clientUuid!==this.initializer.clientUuid||this.state.googleDriveUrl||this.sendMessage({type:"end-integration",payload:{}});break;case"request-integration-state":this.log("Received request for integration state"),this.sendMessage({type:"receive-integration-state",payload:this.state});break;default:this.processComponentMessage(e)}}processIntegrationMessage(e){switch(e.type){case"receive-google-drive-url":i(e.payload)&&(this.state.googleDriveUrl=e.payload,this.renderComponent())}}processComponentMessage(e){switch(e.type){case"google-drive-url-changed":this.sendMessage({type:"relay-message",payload:{type:"receive-google-drive-url",payload:e.payload}});break;case"file-picker-closed":if(this.state.googleDriveUrl)break;e.payload.googleDriveUrl?(this.log("Google drive url picked: ",e.payload.googleDriveUrl),this.processComponentMessage({type:"google-drive-url-changed",payload:e.payload.googleDriveUrl})):(this.log("No google drive url picked, ending integration"),this.sendMessage({type:"end-integration",payload:{}}));break;case"file-picker-opened":this.log("The file picker was opened"),function(e,t){const i=window.outerWidth/2+window.screenX-t.width/2,o=window.outerHeight/2+window.screenY-t.height/2;let n=window.open("picker.html","_blank",`fullscreen=0,menubar=0,location=0,directories=0,toolbar=0,titlebar=0,width=${t.width},height=${t.height},top=${o},left=${i}`);if(t.onclose)var l=setInterval((()=>{n.closed&&(clearInterval(l),t.onclose())}),1e3)}(0,{onclose:()=>this.processComponentMessage({type:"file-picker-closed",payload:{}}),width:1024,height:1024})}}sendMessage(e){this.kosyClient.postMessage(e,"*")}renderComponent(){!function(t,i){let o;o=(null==t?void 0:t.googleDriveUrl)?e:t.currentClient.clientUuid==t.initializer.clientUuid?n:l;let r=document.getElementById("root");var a=r.cloneNode(!1);r.parentNode.replaceChild(a,r),a.appendChild(o(t,i))}({googleDriveUrl:this.state.googleDriveUrl,currentClient:this.currentClient,initializer:this.initializer},(e=>this.receiveMessage(e)))}log(...e){var t,i;console.log(`${null!==(i=null===(t=this.currentClient)||void 0===t?void 0:t.clientName)&&void 0!==i?i:"New user"} logged: `,...e)}}t.App=o,(new o).start({})})((o=t.Integration||(t.Integration={})).GoogleDrive||(o.GoogleDrive={}))}(o||(o={}))})()})();