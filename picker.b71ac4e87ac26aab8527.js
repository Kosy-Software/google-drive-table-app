(()=>{"use strict";(()=>{const e=JSON.parse('{"l":{"c":"AIzaSyDFUoIEXWGk0NPtqPjCadqnEpcgxydw9ko","x":"1055348097262-m31jmp68886tmq7hmsa7pgg0fopb9dot.apps.googleusercontent.com"}}');var t=function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function c(e){try{s(i.next(e))}catch(e){r(e)}}function l(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,l)}s((i=i.apply(e,t||[])).next())}))};const o=new RegExp("^(https://(drive|docs).google.com)","i"),i="https://www.googleapis.com/auth/drive.file",n=new Date("1970-01-01T00:00:00Z").getTime();function r(){return t(this,void 0,void 0,(function*(){let o=JSON.parse(localStorage.getItem("google_access_token")||"{}");return new Date(n+((null==o?void 0:o.expires_at)||0)-6e4)<new Date&&(o=yield function(e){return t(this,void 0,void 0,(function*(){return yield c("auth2"),yield new Promise(((t,o)=>{try{gapi.auth2.init({client_id:e,scope:i,fetch_basic_profile:!1});let r=gapi.auth2.getAuthInstance();var n=r.currentUser.get();n.hasGrantedScopes(i)?t(n.getAuthResponse(!0)):r.signIn().then((e=>t(e.getAuthResponse(!0)))).catch((e=>o(e)))}catch(e){o()}}))}))}(e.l.x),localStorage.setItem("google_access_token",JSON.stringify(o))),o}))}function c(e){return t(this,void 0,void 0,(function*(){return new Promise(((t,o)=>gapi.load(e,{callback:()=>t({}),onerror:()=>o(),timeout:5e3,ontimeout:()=>o()})))}))}var l,s=function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function c(e){try{s(i.next(e))}catch(e){r(e)}}function l(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,l)}s((i=i.apply(e,t||[])).next())}))};!function(i){var n;(function(i){class n{start(){return s(this,void 0,void 0,(function*(){let t=yield r();t||window.close(),(yield this.createPicker(t.access_token,e.l.c)).setVisible(!0)}))}createPicker(i,n){return s(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{gapi.load("picker",{callback:()=>e({}),onerror:()=>t(),timeout:5e3,ontimeout:()=>t()})})),(new google.picker.PickerBuilder).addView(google.picker.ViewId.DOCS).setOAuthToken(i).setDeveloperKey(n).enableFeature(google.picker.Feature.NAV_HIDDEN).setOrigin(`${window.location.protocol}//${window.location.host}`).setCallback((i=>s(this,void 0,void 0,(function*(){if(i[google.picker.Response.ACTION]==google.picker.Action.PICKED){let n=i[google.picker.Response.DOCUMENTS][0][google.picker.Document.ID],l=yield function(i){return t(this,void 0,void 0,(function*(){if(!i)return null;let t=yield r();if(!t)return null;yield c("client"),gapi.client.setApiKey(e.l.c),gapi.client.setToken({access_token:t.access_token});let n=`https://drive.google.com/file/d/${i}/preview`;try{let e=yield gapi.client.request({path:`https://www.googleapis.com/drive/v3/files/${i}?fields=webViewLink,shared`}),t=JSON.parse((null==e?void 0:e.body)||"{}"),r=null;return t.webViewLink&&(r=o.test(t.webViewLink)?t.webViewLink.replace("/view","/preview"):n),t.shared?{url:r}:{url:r,error:"NotShared"}}catch(e){return{url:n,error:"NotFound"}}}))}(n);this.sendMessage({type:"google-drive-validation-changed",payload:l}),window.close()}i[google.picker.Response.ACTION]==google.picker.Action.CANCEL&&window.close()})))).build()}))}sendMessage(e){window.opener.postMessage(e,window.location.origin)}}i.Picker=n,(new n).start()})((n=i.Integration||(i.Integration={})).GoogleDrive||(n.GoogleDrive={}))}(l||(l={}))})()})();