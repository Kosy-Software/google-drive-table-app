(()=>{"use strict";(()=>{function e(){}function t(e){return e()}function n(){return Object.create(null)}function i(e){e.forEach(t)}function o(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e){return 0===Object.keys(e).length}function l(e,t,n,i){return e[1]&&i?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](i(t))):n.ctx}function c(e,t){e.appendChild(t)}function a(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode.removeChild(e)}function d(e){return document.createElement(e)}function g(e){return document.createTextNode(e)}function p(){return g(" ")}function f(){return g("")}function h(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function v(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function $(e,t){e.value=null==t?"":t}function y(e,t,n){e.classList[n?"add":"remove"](t)}let w;function b(e){w=e}function k(){if(!w)throw new Error("Function called outside component initialization");return w}function x(){const e=k();return(t,n)=>{const i=e.$$.callbacks[t];if(i){const o=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);i.slice().forEach((t=>{t.call(e,o)}))}}}function _(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e(t)))}new Set,new Set;const C=[],U=[],M=[],N=[],A=Promise.resolve();let S=!1;function I(e){M.push(e)}let R=!1;const E=new Set;function P(){if(!R){R=!0;do{for(let e=0;e<C.length;e+=1){const t=C[e];b(t),T(t.$$)}for(b(null),C.length=0;U.length;)U.pop()();for(let e=0;e<M.length;e+=1){const t=M[e];E.has(t)||(E.add(t),t())}M.length=0}while(C.length);for(;N.length;)N.pop()();S=!1,R=!1,E.clear()}}function T(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(I)}}const z=new Set;let D,L;function H(){D={r:0,c:[],p:D}}function O(){D.r||i(D.c),D=D.p}function j(e,t){e&&e.i&&(z.delete(e),e.i(t))}function G(e,t,n,i){if(e&&e.o){if(z.has(e))return;z.add(e),D.c.push((()=>{z.delete(e),i&&(n&&e.d(1),i())})),e.o(t)}}function K(e,t){const n=t.token={};function i(e,i,o,s){if(t.token!==n)return;t.resolved=s;let r=t.ctx;void 0!==o&&(r=r.slice(),r[o]=s);const l=e&&(t.current=e)(r);let c=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==i&&e&&(H(),G(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),O())})):t.block.d(1),l.c(),j(l,1),l.m(t.mount(),t.anchor),c=!0),t.block=l,t.blocks&&(t.blocks[i]=l),c&&P()}if((o=e)&&"object"==typeof o&&"function"==typeof o.then){const n=k();if(e.then((e=>{b(n),i(t.then,1,t.value,e),b(null)}),(e=>{if(b(n),i(t.catch,2,t.error,e),b(null),!t.hasCatch)throw e})),t.current!==t.pending)return i(t.pending,0),!0}else{if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved=e}var o}function q(e){e&&e.c()}function J(e,n,s,r){const{fragment:l,on_mount:c,on_destroy:a,after_update:u}=e.$$;l&&l.m(n,s),r||I((()=>{const n=c.map(t).filter(o);a?a.push(...n):i(n),e.$$.on_mount=[]})),u.forEach(I)}function B(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function F(t,o,s,r,l,c,a=[-1]){const d=w;b(t);const g=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:o.context||[]),callbacks:n(),dirty:a,skip_bound:!1};let p=!1;if(g.ctx=s?s(t,o.props||{},((e,n,...i)=>{const o=i.length?i[0]:n;return g.ctx&&l(g.ctx[e],g.ctx[e]=o)&&(!g.skip_bound&&g.bound[e]&&g.bound[e](o),p&&function(e,t){-1===e.$$.dirty[0]&&(C.push(e),S||(S=!0,A.then(P)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],g.update(),p=!0,i(g.before_update),g.fragment=!!r&&r(g.ctx),o.target){if(o.hydrate){const e=(f=o.target,Array.from(f.childNodes));g.fragment&&g.fragment.l(e),e.forEach(u)}else g.fragment&&g.fragment.c();o.intro&&j(t.$$.fragment),J(t,o.target,o.anchor,o.customElement),P()}var f;b(d)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(L=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(o);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){i(this.$$.on_disconnect)}$destroy(){B(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!r(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class V{$destroy(){B(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!r(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class W{constructor(e){this.kosyClient=window.parent,this.latestMessageNumber=0,this.kosyApp=e}startApp(){return this.initialInfoPromise=new Promise(((e,t)=>{window.addEventListener("message",(t=>{let n=t.data;switch(n.type){case"receive-initial-info":this.latestMessageNumber=n.latestMessageNumber,this.log("Resolving initial info promise with: ",n.payload),e(n.payload);break;case"client-has-joined":let t=n.clientInfo;this.initialInfoPromise.then((()=>{this.log("On client has joined: ",t),this.kosyApp.onClientHasJoined(t)}));break;case"client-has-left":let i=n.clientUuid;this.initialInfoPromise.then((()=>{this.log("On client has left: ",i),this.kosyApp.onClientHasLeft(i)}));break;case"get-app-state":let o=n.clientUuids;this.initialInfoPromise.then((()=>{this.log("Get app state received -> sending app state");const e=this.kosyApp.onRequestState();this._sendMessageToKosy({type:"receive-app-state",state:e,clientUuids:o,latestMessageNumber:this.latestMessageNumber})}));break;case"set-app-state":this.latestMessageNumber=n.latestMessageNumber;let s=n.state;this.initialInfoPromise.then((()=>{this.log("Received app state from Kosy -> setting app state"),this.kosyApp.onProvideState(s)}));break;case"receive-message-as-host":this._handleReceiveMessageAsHost(n);break;case"receive-message-as-client":this._handleReceiveMessageAsClient(n)}})),this._sendMessageToKosy({type:"ready-and-listening"})})),this.initialInfoPromise}stopApp(){this._sendMessageToKosy({type:"stop-app"})}relayMessage(e){this.log("Relaying client message to host: ",e),this._sendMessageToKosy({type:"relay-message-to-host",message:e})}_sendMessageToKosy(e){this.kosyClient.postMessage(e,"*")}_handleReceiveMessageAsClientRecursive(e,t,n){this.latestMessageNumber===e.messageNumber-(t.currentClientUuid===e.sentByClientUuid?0:1)?(this.kosyApp.onReceiveMessageAsClient(e.message),this.latestMessageNumber=e.messageNumber):(n<50&&this.latestMessageNumber<e.messageNumber&&setTimeout((()=>this._handleReceiveMessageAsClientRecursive(e,t,n+1)),100),this.log("Timeout on processing message as client: ",e.message),this.log("Wait for Kosy to fix this mess..."))}_handleReceiveMessageAsClient(e){this.initialInfoPromise.then((t=>{this.log("Received message as client, processing: ",e.message),this._handleReceiveMessageAsClientRecursive(e,t,0)}))}_handleReceiveMessageAsHost(e){this.initialInfoPromise.then((t=>{this.log("Trying to handle message as host");const n=this.kosyApp.onReceiveMessageAsHost(e.message);n&&(this.log("Host message was converted into client message -> notifying kosy with a relay to clients message",n),this._sendMessageToKosy({type:"relay-message-to-clients",sentByClientUuid:t.currentClientUuid,message:n,messageNumber:++this.latestMessageNumber}))}))}log(...e){"1"===localStorage.getItem("debug-mode")&&console.log("From kosy-app-api: ",...e)}}const X=JSON.parse('{"l":{"c":"AIzaSyA0FVCn0xu3OFqynefuTwy5-Toatw-XLyg","x":"616819909997-uh4gnbl6pjhu4p8ic3vrgof49vejr5nn.apps.googleusercontent.com"}}'),Y=new RegExp("^(https://\\w+.google.com)"),Z=new RegExp("^(https://(drive|docs).google.com)","i"),Q=new RegExp("/d/([-\\w]{25,})"),ee="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.metadata.readonly",te=new Date("1970-01-01T00:00:00Z").getTime();function ne(e){let t=new URL(e.replace("/preview","/edit"));return t.searchParams.append("userstoinvite","@"),t.toString()}async function ie(e){let t=oe(e);await ce("client");let n=await se();gapi.client.setApiKey(X.l.c),gapi.client.setToken({access_token:n.access_token});try{let n=await gapi.client.request({path:`https://www.googleapis.com/drive/v3/files/${t}?fields=webViewLink`}),i=JSON.parse((null==n?void 0:n.body)||"{}").webViewLink;if(i){if(Z.test(i))return Promise.resolve(e.replace("/view","/preview"));{let e=oe(i);return Promise.resolve(`https://drive.google.com/file/d/${e}/preview`)}}return Promise.reject()}catch(e){return Promise.reject()}}function oe(e){let t=e.match(Q);return t&&t.length>1?t[1]:null}async function se(){let e=JSON.parse(localStorage.getItem("google_access_token")||"{}");return new Date(te+((null==e?void 0:e.expires_at)||6e5)-6e4)<new Date&&(e=await async function(){return await ce("auth2"),await re((e=>new Promise(((t,n)=>{try{let i=e.currentUser.get();i.hasGrantedScopes(ee)?t(i.getAuthResponse(!0)):e.signIn().then((e=>t(e.getAuthResponse(!0)))).catch((e=>n(e)))}catch(e){n()}}))))}(),localStorage.setItem("google_access_token",JSON.stringify(e))),e}function re(e){return gapi.auth2.init({client_id:X.l.x,scope:ee}).then((()=>e(gapi.auth2.getAuthInstance())))}async function le(){return await ce("auth2"),re((e=>e.isSignedIn.get()&&e.currentUser.get().hasGrantedScopes(ee)))}async function ce(e){return new Promise(((t,n)=>gapi.load(e,{callback:()=>t({}),onerror:()=>n(),timeout:5e3,ontimeout:()=>n()})))}function ae(e){let t;function n(e,t){return e[0].clientUuid!==e[1].clientUuid?de:ue}let i=n(e),o=i(e);return{c(){o.c(),t=f()},m(e,n){o.m(e,n),a(e,t,n)},p(e,s){i===(i=n(e))&&o?o.p(e,s):(o.d(1),o=i(e),o&&(o.c(),o.m(t.parentNode,t)))},d(e){o.d(e),e&&u(t)}}}function ue(t){let n;return{c(){n=d("div"),n.textContent="The file you were trying to share is not available to you..."},m(e,t){a(e,n,t)},p:e,d(e){e&&u(n)}}}function de(e){let t,n,i,o,s=e[0].clientName+"";return{c(){t=d("div"),n=g("You do not have access to this file. Please ask "),i=g(s),o=g(" to share the file with you.")},m(e,s){a(e,t,s),c(t,n),c(t,i),c(t,o)},p(e,t){1&t&&s!==(s=e[0].clientName+"")&&v(i,s)},d(e){e&&u(t)}}}function ge(e){let t,n;return{c(){t=d("iframe"),m(t,"title","google drive "),t.src!==(n=e[4])&&m(t,"src",n),m(t,"class","svelte-tbe2c")},m(e,n){a(e,t,n)},p(e,i){4&i&&t.src!==(n=e[4])&&m(t,"src",n)},d(e){e&&u(t)}}}function pe(t){let n;return{c(){n=d("div"),n.textContent="Loading..."},m(e,t){a(e,n,t)},p:e,d(e){e&&u(n)}}}function fe(t){let n,i,o={ctx:t,current:null,token:null,hasCatch:!0,pending:pe,then:ge,catch:ae,value:4};return K(i=t[2],o),{c(){n=f(),o.block.c()},m(e,t){a(e,n,t),o.block.m(e,o.anchor=t),o.mount=()=>n.parentNode,o.anchor=n},p(e,[n]){if(t=e,o.ctx=t,4&n&&i!==(i=t[2])&&K(i,o));else{const e=t.slice();e[4]=o.resolved,o.block.p(e,n)}},i:e,o:e,d(e){e&&u(n),o.block.d(e),o.token=null,o=null}}}function he(e,t,n){let i,{url:o}=t,{initializer:s}=t,{currentClient:r}=t;return e.$$set=e=>{"url"in e&&n(3,o=e.url),"initializer"in e&&n(0,s=e.initializer),"currentClient"in e&&n(1,r=e.currentClient)},e.$$.update=()=>{8&e.$$.dirty&&n(2,i=ie(o))},[s,r,i,o]}const me=class extends V{constructor(e){super(),F(this,e,he,fe,s,{url:3,initializer:0,currentClient:1})}};function ve(e){let t,n,o,s;const r=e[5].default,c=function(e,t,n,i){if(e){const i=l(e,t,n,null);return e[0](i)}}(r,e,e[4]);return{c(){t=d("button"),c&&c.c(),m(t,"class",e[1]),t.disabled=e[0]},m(i,r){a(i,t,r),c&&c.m(t,null),n=!0,o||(s=[h(t,"click",e[6]),h(t,"dblclick",e[7]),h(t,"focus",e[8])],o=!0)},p(e,[i]){c&&c.p&&16&i&&function(e,t,n,i,o,s,r){const c=function(e,t,n,i){if(e[2]&&i){const o=e[2](i(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let i=0;i<n;i+=1)e[i]=t.dirty[i]|o[i];return e}return t.dirty|o}return t.dirty}(t,i,o,null);if(c){const o=l(t,n,i,null);e.p(o,c)}}(c,r,e,e[4],i),(!n||2&i)&&m(t,"class",e[1]),(!n||1&i)&&(t.disabled=e[0])},i(e){n||(j(c,e),n=!0)},o(e){G(c,e),n=!1},d(e){e&&u(t),c&&c.d(e),o=!1,i(s)}}}function $e(e,t,n){let{$$slots:i={},$$scope:o}=t,{size:s}=t,{importance:r}=t,{disabled:l=!1}=t,c="";return e.$$set=e=>{"size"in e&&n(2,s=e.size),"importance"in e&&n(3,r=e.importance),"disabled"in e&&n(0,l=e.disabled),"$$scope"in e&&n(4,o=e.$$scope)},e.$$.update=()=>{if(12&e.$$.dirty){let e=[];s?e.push("size-"+s):e.push("size-regular"),r&&e.push("importance-"+r),n(1,c=["re-button",...e].join(" "))}},[l,c,s,r,o,i,function(t){_(e,t)},function(t){_(e,t)},function(t){_(e,t)}]}const ye=class extends V{constructor(e){super(),F(this,e,$e,ve,s,{size:2,importance:3,disabled:0})}};function we(e){let t;return{c(){t=d("span"),t.textContent="Open file",m(t,"class","text")},m(e,n){a(e,t,n)},d(e){e&&u(t)}}}function be(e){let t,n,i,o;return{c(){t=d("span"),t.textContent="Pick a file",n=p(),i=d("img"),m(t,"class","text"),m(i,"class","icon-right"),m(i,"alt","google drive icon"),i.src!==(o="assets/google-drive-icon.svg")&&m(i,"src","assets/google-drive-icon.svg")},m(e,o){a(e,t,o),a(e,n,o),a(e,i,o)},d(e){e&&u(t),e&&u(n),e&&u(i)}}}function ke(e){let t,n,i,o,s,r;return{c(){t=d("label"),n=g("The file you picked is not a shared file. Please click "),i=d("a"),o=g("here"),r=g(" to enable file sharing."),m(i,"href",s=ne(e[2])),m(i,"target","_blank"),m(t,"class","error-label svelte-1xmwdcv"),m(t,"for","open-picker")},m(e,s){a(e,t,s),c(t,n),c(t,i),c(i,o),c(t,r)},p(e,t){4&t&&s!==(s=ne(e[2]))&&m(i,"href",s)},d(e){e&&u(t)}}}function xe(e){let t;return{c(){t=d("label"),t.textContent="The file you tried to share with the table is not available to you.",m(t,"class","error-label svelte-1xmwdcv"),m(t,"for","open-picker")},m(e,n){a(e,t,n)},d(e){e&&u(t)}}}function _e(e){let t,n,o,s,r,l,g,f,v,w,b,k,x,_,C,U,M;f=new ye({props:{importance:"primary",disabled:!e[4],$$slots:{default:[we]},$$scope:{ctx:e}}}),f.$on("click",e[10]),k=new ye({props:{importance:"secondary",$$slots:{default:[be]},$$scope:{ctx:e}}}),k.$on("click",e[11]);let N=e[0]&&ke(e),A=e[1]&&xe();return{c(){t=d("div"),n=d("div"),n.innerHTML='<h3>Embed google drive</h3> \n        <p class="svelte-1xmwdcv">In Google Docs/Drive, click the Share button,<br/>\n            copy the link and paste below</p>',o=p(),s=d("div"),r=p(),l=d("input"),g=p(),q(f.$$.fragment),v=p(),w=d("p"),w.textContent="OR",b=p(),q(k.$$.fragment),x=p(),N&&N.c(),_=p(),A&&A.c(),m(n,"class","svelte-1xmwdcv"),m(s,"class","gap svelte-1xmwdcv"),m(l,"type","text"),m(l,"placeholder","E.g. https://drive.google.com/..."),m(l,"class","svelte-1xmwdcv"),y(l,"invalid",!e[3]&&!e[4]),y(l,"valid",e[4]),m(w,"class","svelte-1xmwdcv"),m(t,"class","picking svelte-1xmwdcv")},m(i,u){a(i,t,u),c(t,n),c(t,o),c(t,s),c(t,r),c(t,l),$(l,e[2]),c(t,g),J(f,t,null),c(t,v),c(t,w),c(t,b),J(k,t,null),c(t,x),N&&N.m(t,null),c(t,_),A&&A.m(t,null),C=!0,U||(M=[h(l,"input",e[8]),h(l,"input",e[9])],U=!0)},p(e,[n]){4&n&&l.value!==e[2]&&$(l,e[2]),24&n&&y(l,"invalid",!e[3]&&!e[4]),16&n&&y(l,"valid",e[4]);const i={};16&n&&(i.disabled=!e[4]),32768&n&&(i.$$scope={dirty:n,ctx:e}),f.$set(i);const o={};32768&n&&(o.$$scope={dirty:n,ctx:e}),k.$set(o),e[0]?N?N.p(e,n):(N=ke(e),N.c(),N.m(t,_)):N&&(N.d(1),N=null),e[1]?A||(A=xe(),A.c(),A.m(t,null)):A&&(A.d(1),A=null)},i(e){C||(j(f.$$.fragment,e),j(k.$$.fragment,e),C=!0)},o(e){G(f.$$.fragment,e),G(k.$$.fragment,e),C=!1},d(e){e&&u(t),B(f),B(k),N&&N.d(),A&&A.d(),U=!1,i(M)}}}function Ce(e,t,n){let i,o,s;var r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function l(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((i=i.apply(e,t||[])).next())}))};const l=x();let c=!1,a=!1,u="",d=()=>function(e,t){const n=window.outerWidth/2+window.screenX-t.width/2,i=window.outerHeight/2+window.screenY-t.height/2;window.open("picker.html","_blank",`fullscreen=0,menubar=0,location=0,directories=0,toolbar=0,titlebar=0,width=${t.width},height=${t.height},top=${i},left=${n}`)}(0,{width:1024,height:1024}),g=e=>{if(e.data&&e.data.type)switch(e.data.type){case"google-drive-url-picked":e.data.payload.error?(n(0,c=!0),n(2,u=e.data.payload.url)):l("picked",e.data.payload.url)}};var p;window.addEventListener("message",g),p=()=>window.removeEventListener("message",g),k().$$.on_destroy.push(p);let f=()=>r(void 0,void 0,void 0,(function*(){ie(u).then((e=>l("picked",e))).catch((()=>{n(1,a=!0)}))}));return e.$$.update=()=>{var t;4&e.$$.dirty&&n(3,i=""===u),12&e.$$.dirty&&n(7,o=!(i||(t=u,t&&Y.test(t)))),139&e.$$.dirty&&n(4,s=!i&&!(o||c||a))},[c,a,u,i,s,d,f,o,function(){u=this.value,n(2,u)},()=>{n(0,c=!1),n(1,a=!1)},()=>f(),()=>d()]}const Ue=class extends V{constructor(e){super(),F(this,e,Ce,_e,s,{})}};function Me(e){let t,n,i,o=e[2].clientName+"";return{c(){t=d("p"),n=g(o),i=g(" is picking a file to share")},m(e,o){a(e,t,o),c(t,n),c(t,i)},p(e,t){4&t&&o!==(o=e[2].clientName+"")&&v(n,o)},d(e){e&&u(t)}}}function Ne(e){let t,n,i,o,s,r=e[2].clientName+"";return{c(){t=d("p"),n=g(r),i=g(" has picked a file to share, "),o=d("br"),s=g("\n            please log in with google to view it.")},m(e,r){a(e,t,r),c(t,n),c(t,i),c(t,o),c(t,s)},p(e,t){4&t&&r!==(r=e[2].clientName+"")&&v(n,r)},d(e){e&&u(t)}}}function Ae(t){let n;return{c(){n=d("p"),n.textContent="To start sharing a file, please log in with google"},m(e,t){a(e,n,t)},p:e,d(e){e&&u(n)}}}function Se(e){let t,n;return t=new ye({props:{importance:"secondary",$$slots:{default:[Ie]},$$scope:{ctx:e}}}),t.$on("click",e[5]),{c(){q(t.$$.fragment)},m(e,i){J(t,e,i),n=!0},p(e,n){const i={};256&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(j(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){B(t,e)}}}function Ie(e){let t,n,i,o;return{c(){t=d("span"),t.textContent="Log in with Google",n=p(),i=d("img"),m(t,"class","text"),m(i,"class","icon-right"),m(i,"alt","google-icon"),i.src!==(o="assets/google-icon.svg")&&m(i,"src","assets/google-icon.svg")},m(e,o){a(e,t,o),a(e,n,o),a(e,i,o)},d(e){e&&u(t),e&&u(n),e&&u(i)}}}function Re(e){let t,n,i,o,s,r,l,g,f,h,v;function $(e,t){return e[2].clientUuid===e[3].clientUuid?Ae:e[0]?Ne:Me}let y=$(e),w=y(e),b=!e[1]&&Se(e);return{c(){t=d("div"),n=d("h3"),n.textContent="Google Drive sharing",i=p(),w.c(),o=p(),s=d("div"),r=p(),l=d("div"),l.innerHTML='<img alt="waiting" src="assets/waiting.svg"/>',g=p(),f=d("div"),h=p(),b&&b.c(),m(s,"class","gap svelte-168y7ua"),m(l,"class","img-container svelte-168y7ua"),m(f,"class","gap svelte-168y7ua"),m(t,"class","waiting svelte-168y7ua")},m(e,u){a(e,t,u),c(t,n),c(t,i),w.m(t,null),c(t,o),c(t,s),c(t,r),c(t,l),c(t,g),c(t,f),c(t,h),b&&b.m(t,null),v=!0},p(e,[n]){y===(y=$(e))&&w?w.p(e,n):(w.d(1),w=y(e),w&&(w.c(),w.m(t,o))),e[1]?b&&(H(),G(b,1,1,(()=>{b=null})),O()):b?(b.p(e,n),2&n&&j(b,1)):(b=Se(e),b.c(),j(b,1),b.m(t,null))},i(e){v||(j(b),v=!0)},o(e){G(b),v=!1},d(e){e&&u(t),w.d(),b&&b.d()}}}function Ee(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function l(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((i=i.apply(e,t||[])).next())}))};let{googleDriveUrl:o}=t,{currentUserIsSignedIntoGoogle:s}=t,{initializer:r}=t,{currentClient:l}=t;const c=x();let a=()=>i(void 0,void 0,void 0,(function*(){yield se().catch((()=>Promise.resolve())),c("signed-in")}));return e.$$set=e=>{"googleDriveUrl"in e&&n(0,o=e.googleDriveUrl),"currentUserIsSignedIntoGoogle"in e&&n(1,s=e.currentUserIsSignedIntoGoogle),"initializer"in e&&n(2,r=e.initializer),"currentClient"in e&&n(3,l=e.currentClient)},[o,s,r,l,a,()=>a()]}const Pe=class extends V{constructor(e){super(),F(this,e,Ee,Re,s,{googleDriveUrl:0,currentUserIsSignedIntoGoogle:1,initializer:2,currentClient:3})}};function Te(e){let t,n,i,o;const s=[Le,De,ze],r=[];function l(e,t){return e[0].googleDriveUrl&&e[3]?0:e[2].clientUuid==e[1].clientUuid&&e[3]?1:2}return t=l(e),n=r[t]=s[t](e),{c(){n.c(),i=f()},m(e,n){r[t].m(e,n),a(e,i,n),o=!0},p(e,o){let c=t;t=l(e),t===c?r[t].p(e,o):(H(),G(r[c],1,1,(()=>{r[c]=null})),O(),n=r[t],n?n.p(e,o):(n=r[t]=s[t](e),n.c()),j(n,1),n.m(i.parentNode,i))},i(e){o||(j(n),o=!0)},o(e){G(n),o=!1},d(e){r[t].d(e),e&&u(i)}}}function ze(e){let t,n;return t=new Pe({props:{initializer:e[1],currentClient:e[2],currentUserIsSignedIntoGoogle:e[3],googleDriveUrl:e[0].googleDriveUrl}}),t.$on("signed-in",e[7]),{c(){q(t.$$.fragment)},m(e,i){J(t,e,i),n=!0},p(e,n){const i={};2&n&&(i.initializer=e[1]),4&n&&(i.currentClient=e[2]),8&n&&(i.currentUserIsSignedIntoGoogle=e[3]),1&n&&(i.googleDriveUrl=e[0].googleDriveUrl),t.$set(i)},i(e){n||(j(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){B(t,e)}}}function De(t){let n,i;return n=new Ue({}),n.$on("picked",t[6]),{c(){q(n.$$.fragment)},m(e,t){J(n,e,t),i=!0},p:e,i(e){i||(j(n.$$.fragment,e),i=!0)},o(e){G(n.$$.fragment,e),i=!1},d(e){B(n,e)}}}function Le(e){let t,n;return t=new me({props:{initializer:e[1],currentClient:e[2],url:e[0].googleDriveUrl}}),{c(){q(t.$$.fragment)},m(e,i){J(t,e,i),n=!0},p(e,n){const i={};2&n&&(i.initializer=e[1]),4&n&&(i.currentClient=e[2]),1&n&&(i.url=e[0].googleDriveUrl),t.$set(i)},i(e){n||(j(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){B(t,e)}}}function He(e){let t,n,i=e[1]&&e[2]&&Te(e);return{c(){i&&i.c(),t=f()},m(e,o){i&&i.m(e,o),a(e,t,o),n=!0},p(e,[n]){e[1]&&e[2]?i?(i.p(e,n),6&n&&j(i,1)):(i=Te(e),i.c(),j(i,1),i.m(t.parentNode,t)):i&&(H(),G(i,1,1,(()=>{i=null})),O())},i(e){n||(j(i),n=!0)},o(e){G(i),n=!1},d(e){i&&i.d(e),e&&u(t)}}}function Oe(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function l(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((i=i.apply(e,t||[])).next())}))};let o,s,r={googleDriveUrl:null},l=!1,c=new W({onClientHasJoined:e=>{},onClientHasLeft:e=>function(e){e!==o.clientUuid||r.googleDriveUrl||c.stopApp()}(e),onReceiveMessageAsHost:e=>e,onReceiveMessageAsClient:e=>{!function(e){switch(e.type){case"receive-google-drive-url":d("Received a message from Kosy: ",e),n(0,r.googleDriveUrl=e.payload,r)}}(e)},onRequestState:()=>r,onProvideState:e=>function(e){n(0,r=e)}(e)});c.startApp().then((e=>i(void 0,void 0,void 0,(function*(){var t;n(3,l=yield le()),n(1,o=e.clients[e.initializerClientUuid]),n(2,s=e.clients[e.currentClientUuid]),n(0,r=null!==(t=e.currentAppState)&&void 0!==t?t:r)}))));let a=e=>{d("Relaying message: drive url picked",e),c.relayMessage({type:"receive-google-drive-url",payload:e})},u=()=>i(void 0,void 0,void 0,(function*(){d("Signed in with google -> refreshing views if necessary"),n(3,l=yield le())}));function d(...e){var t;console.log(`${null!==(t=null==s?void 0:s.clientName)&&void 0!==t?t:"New user"} logged: `,...e)}return[r,o,s,l,a,u,e=>a(e.detail),()=>u()]}new class extends V{constructor(e){super(),F(this,e,Oe,He,s,{})}}({target:document.getElementById("container"),props:{}})})()})();