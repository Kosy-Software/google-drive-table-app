(()=>{"use strict";(()=>{const e=JSON.parse('{"google":{"api_key":"AIzaSyDFUoIEXWGk0NPtqPjCadqnEpcgxydw9ko","client_id":"1055348097262-m31jmp68886tmq7hmsa7pgg0fopb9dot.apps.googleusercontent.com"}}');var o,t=function(e,o,t,i){return new(t||(t=Promise))((function(n,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function c(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var o;e.done?n(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,c)}l((i=i.apply(e,o||[])).next())}))};!function(o){var i;(function(o){const i="https://www.googleapis.com/auth/drive.file",n=new Date("1970-01-01T00:00:00Z").getTime(),r=/https:\/\/(drive|docs)\.google\.com.*\/edit.*/;class s{start(e){return t(this,void 0,void 0,(function*(){let o=yield this.getAuthResponse(e.google.client_id);o||(this.sendMessage({type:"file-picker-closed",payload:{}}),window.close()),(yield this.createPicker(o.access_token,e.google.api_key)).setVisible(!0)}))}getAuthResponse(e){return t(this,void 0,void 0,(function*(){let o=JSON.parse(localStorage.getItem("google_access_token")||"{}");return new Date(n+((null==o?void 0:o.expires_at)||0)-6e4)<new Date&&(o=yield this.authorizeAppForGoogleDrive(e),localStorage.setItem("google_access_token",JSON.stringify(o))),o}))}authorizeAppForGoogleDrive(e){return t(this,void 0,void 0,(function*(){return yield new Promise(((e,o)=>{gapi.load("auth2",{callback:()=>e({}),onerror:()=>o(),timeout:5e3,ontimeout:()=>o()})})),yield new Promise(((o,t)=>{try{gapi.auth2.init({client_id:e,scope:i,fetch_basic_profile:!1});let r=gapi.auth2.getAuthInstance();var n=r.currentUser.get();n.hasGrantedScopes(i)?o(n.getAuthResponse(!0)):r.signIn().then((e=>o(e.getAuthResponse(!0)))).catch((e=>t(e)))}catch(e){t()}}))}))}createPicker(e,o){return t(this,void 0,void 0,(function*(){return yield new Promise(((e,o)=>{gapi.load("picker",{callback:()=>e({}),onerror:()=>o(),timeout:5e3,ontimeout:()=>o()})})),(new google.picker.PickerBuilder).addView(google.picker.ViewId.DOCS).addView((new google.picker.DocsUploadView).setIncludeFolders(!0)).setOAuthToken(e).setDeveloperKey(o).setOrigin(`${window.location.protocol}//${window.location.host}`).setCallback((e=>{var o;if(e[google.picker.Response.ACTION]==google.picker.Action.PICKED){alert("picked");let t=e[google.picker.Response.DOCUMENTS][0],i=t[google.picker.Document.URL],n=null!==(o=t[google.picker.Document.EMBEDDABLE_URL])&&void 0!==o?o:i.replace("/view","/preview"),s=r.test(i)?i:n;this.sendMessage({type:"file-picker-closed",payload:{googleDriveUrl:s}}),window.close()}e[google.picker.Response.ACTION]==google.picker.Action.CANCEL&&(alert("canceled?"),this.sendMessage({type:"file-picker-closed",payload:{}}),window.close())})).build()}))}sendMessage(e){window.opener.postMessage(e,window.location.origin)}}o.Picker=s,(new s).start(e)})((i=o.Integration||(o.Integration={})).GoogleDrive||(i.GoogleDrive={}))}(o||(o={}))})()})();