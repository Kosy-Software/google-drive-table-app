(()=>{"use strict";(()=>{const e=JSON.parse('{"l":{"c":"AIzaSyA0FVCn0xu3OFqynefuTwy5-Toatw-XLyg","x":"616819909997-uh4gnbl6pjhu4p8ic3vrgof49vejr5nn.apps.googleusercontent.com"}}');var t=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function c(e){try{s(n.next(e))}catch(e){r(e)}}function l(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,l)}s((n=n.apply(e,t||[])).next())}))};const o=new RegExp("^(https://(drive|docs).google.com)","i"),n="https://www.googleapis.com/auth/drive.file",i=new Date("1970-01-01T00:00:00Z").getTime();function r(){return t(this,void 0,void 0,(function*(){let o=JSON.parse(localStorage.getItem("google_access_token")||"{}");return new Date(i+((null==o?void 0:o.expires_at)||0)-6e4)<new Date&&(o=yield function(e){return t(this,void 0,void 0,(function*(){return yield c("auth2"),yield new Promise(((t,o)=>{try{gapi.auth2.init({client_id:e,scope:n,fetch_basic_profile:!1});let r=gapi.auth2.getAuthInstance();var i=r.currentUser.get();i.hasGrantedScopes(n)?t(i.getAuthResponse(!0)):r.signIn().then((e=>t(e.getAuthResponse(!0)))).catch((e=>o(e)))}catch(e){o()}}))}))}(e.l.x),localStorage.setItem("google_access_token",JSON.stringify(o))),o}))}function c(e){return t(this,void 0,void 0,(function*(){return new Promise(((t,o)=>gapi.load(e,{callback:()=>t({}),onerror:()=>o(),timeout:5e3,ontimeout:()=>o()})))}))}var l,s=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function c(e){try{s(n.next(e))}catch(e){r(e)}}function l(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,l)}s((n=n.apply(e,t||[])).next())}))};!function(n){var i;(function(n){class i{start(){return s(this,void 0,void 0,(function*(){let t=yield r();t||window.close(),(yield this.createPicker(t.access_token,e.l.c)).setVisible(!0)}))}createPicker(n,i){return s(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{gapi.load("picker",{callback:()=>e({}),onerror:()=>t(),timeout:5e3,ontimeout:()=>t()})})),(new google.picker.PickerBuilder).addView(google.picker.ViewId.DOCS).setOAuthToken(n).setDeveloperKey(i).enableFeature(google.picker.Feature.NAV_HIDDEN).setOrigin(`${window.location.protocol}//${window.location.host}`).setCallback((n=>s(this,void 0,void 0,(function*(){if(n[google.picker.Response.ACTION]==google.picker.Action.PICKED){let i=n[google.picker.Response.DOCUMENTS][0][google.picker.Document.ID],l=yield function(n){return t(this,void 0,void 0,(function*(){if(!n)return null;let t=yield r();if(!t)return null;yield c("client"),gapi.client.setApiKey(e.l.c),gapi.client.setToken({access_token:t.access_token});let i=`https://drive.google.com/file/d/${n}/preview`;try{let e=yield gapi.client.request({path:`https://www.googleapis.com/drive/v3/files/${n}?fields=webViewLink,shared`}),t=JSON.parse((null==e?void 0:e.body)||"{}"),r=null;return t.webViewLink&&(r=o.test(t.webViewLink)?t.webViewLink.replace("/view","/preview"):i),t.shared?{url:r}:{url:r,error:"NotShared"}}catch(e){return{url:i,error:"NotFound"}}}))}(i);this.sendMessage({type:"google-drive-validation-changed",payload:l}),window.close()}n[google.picker.Response.ACTION]==google.picker.Action.CANCEL&&window.close()})))).build()}))}sendMessage(e){window.opener.postMessage(e,window.location.origin)}}n.Picker=i,(new i).start()})((i=n.Integration||(n.Integration={})).GoogleDrive||(i.GoogleDrive={}))}(l||(l={}))})()})();